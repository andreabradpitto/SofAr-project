\hypertarget{namespacejac__mat}{}\doxysection{jac\+\_\+mat Namespace Reference}
\label{namespacejac__mat}\index{jac\_mat@{jac\_mat}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacejac__mat_acea62356e13dcd40a0f7b69288cb1ff8}{sat}} (x, xmin, xmax)
\begin{DoxyCompactList}\small\item\em Saturates the input value in the given interval. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a701c95f46a60e0d4735aa9f3b9d1c0ad}{bell}} (s)
\begin{DoxyCompactList}\small\item\em Creates a bell shaped function to regularize singular values. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a1b70eedcec80991a4a9e4befb0d4f72a}{regularized\+\_\+pseudoinverse}} (\mbox{\hyperlink{ik_8cpp_af2f8d0151c18d9e648b6353879e885ad}{J}})
\begin{DoxyCompactList}\small\item\em Computes the regularized pseudo inverse of mxn matrix J by applying svd decomposition and multiplication for bell shaped function. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a860043b48277a9033f9576db20cc1c63}{calculations\+\_\+6}} (q\+\_\+coppelia)
\begin{DoxyCompactList}\small\item\em Builds the 6 dof Jacobian by computing the transformation matrices, extracting the geometric vectors from the results and finally building the matrix. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a3f8d14b0577487e6feb88e38d5518ad5}{jacobian\+\_\+callback}} (data)
\begin{DoxyCompactList}\small\item\em Callback Function for the Joints Positions. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_ab6fa90b8afa2d953a8f166c55b4792c5}{error\+\_\+callback}} (message)
\begin{DoxyCompactList}\small\item\em Callback Function for the error on the position of the ee. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a12b4ec5da8077136f06320ce5d577407}{vel\+\_\+callback}} (message)
\begin{DoxyCompactList}\small\item\em Callback Function for the linear and angular velocities of the ee. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a79b5770d439fef38364187d16902bf41}{handle\+\_\+\+I\+K\+\_\+\+J\+Analytic}} (req)
\begin{DoxyCompactList}\small\item\em Handler for the Server\+: computes the ee velocity Vee and the joint velocities vector q\+\_\+dot Vee is computed as\+: Vee = vel + K$\ast$error q\+\_\+dot is computed as\+: q\+\_\+dot = J\# $\ast$ Vee then each value of q\+\_\+dot is saturated in a pre-\/determined interval. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacejac__mat_a8e223e62c8624094cfa20b52b1c098f0}{jac\+\_\+mat}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{namespacejac__mat_a85ca3feeaa6ba1dfd16285a59c4ef174}{ready\+Err}} = False
\item 
bool \mbox{\hyperlink{namespacejac__mat_af336a5a7bf90772409bbb56da3c600c9}{readyJ}} = False
\item 
bool \mbox{\hyperlink{namespacejac__mat_a707dd549cfb0f1316be715adebc23f90}{ready\+Vel}} = False
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacejac__mat_a701c95f46a60e0d4735aa9f3b9d1c0ad}\label{namespacejac__mat_a701c95f46a60e0d4735aa9f3b9d1c0ad}} 
\index{jac\_mat@{jac\_mat}!bell@{bell}}
\index{bell@{bell}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{bell()}{bell()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+bell (\begin{DoxyParamCaption}\item[{}]{s }\end{DoxyParamCaption})}



Creates a bell shaped function to regularize singular values. 


\begin{DoxyParams}{Parameters}
{\em s} & singular value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
p\+: regularized singular value 
\end{DoxyReturn}


Definition at line 45 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{45 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a701c95f46a60e0d4735aa9f3b9d1c0ad}{bell}}(s):}
\DoxyCodeLine{46     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{47 \textcolor{stringliteral}{    Creates a bell shaped function to regularize singular values}}
\DoxyCodeLine{48 \textcolor{stringliteral}{    @param s: singular value}}
\DoxyCodeLine{49 \textcolor{stringliteral}{    @return p: regularized singular value}}
\DoxyCodeLine{50 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     b = -\/np.log(0.5)/0.00001}
\DoxyCodeLine{53     p = np.exp(-\/b*s*s)}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     \textcolor{keywordflow}{return} p}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_a860043b48277a9033f9576db20cc1c63}\label{namespacejac__mat_a860043b48277a9033f9576db20cc1c63}} 
\index{jac\_mat@{jac\_mat}!calculations\_6@{calculations\_6}}
\index{calculations\_6@{calculations\_6}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{calculations\_6()}{calculations\_6()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+calculations\+\_\+6 (\begin{DoxyParamCaption}\item[{}]{q\+\_\+coppelia }\end{DoxyParamCaption})}



Builds the 6 dof Jacobian by computing the transformation matrices, extracting the geometric vectors from the results and finally building the matrix. 


\begin{DoxyParams}{Parameters}
{\em q\+\_\+coppelia} & vector of the joint positions \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Js\+: Jacobian matrix 
\end{DoxyReturn}


Definition at line 87 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{87 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a860043b48277a9033f9576db20cc1c63}{calculations\_6}}(q\_coppelia):}
\DoxyCodeLine{88     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{89 \textcolor{stringliteral}{    Builds the 6 dof Jacobian by computing the transformation matrices,}}
\DoxyCodeLine{90 \textcolor{stringliteral}{    extracting the geometric vectors from the results and finally building the matrix.}}
\DoxyCodeLine{91 \textcolor{stringliteral}{    @param q\_coppelia: vector of the joint positions}}
\DoxyCodeLine{92 \textcolor{stringliteral}{    @return Js: Jacobian matrix}}
\DoxyCodeLine{93 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     p = np.pi}
\DoxyCodeLine{96     n\_joints = 6}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \textcolor{comment}{\# Links lengths [m]}}
\DoxyCodeLine{99     L0 = 270.35/1000}
\DoxyCodeLine{100     L1 = 69.00/1000}
\DoxyCodeLine{101     L2 = 364.35/1000}
\DoxyCodeLine{102     L3 = 69.00/1000}
\DoxyCodeLine{103     Lh = math.sqrt(L2 ** 2 + L3 ** 2)}
\DoxyCodeLine{104     L4 = 374.29/1000}
\DoxyCodeLine{105     L5 = 0}
\DoxyCodeLine{106     L6 = 368.30/1000}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \textcolor{comment}{\# DH table of Baxter: alpha(i-\/1), a(i-\/1), d(i), theta(i)}}
\DoxyCodeLine{109     DH = np.array([[0, 0, L0, 0],}
\DoxyCodeLine{110                    [-\/p/2, L1, 0, 0],}
\DoxyCodeLine{111                    [0, Lh, 0, p/2],}
\DoxyCodeLine{112                    [p/2, 0, L4, 0],}
\DoxyCodeLine{113                    [-\/p/2, L5, 0, 0],}
\DoxyCodeLine{114                    [p/2, 0, 0, 0],}
\DoxyCodeLine{115                    [0, 0, L6, 0]])}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \textcolor{comment}{\# Transformation matrices given DH table. T0,1 T1,2 ... T7,e}}
\DoxyCodeLine{118     T\_rel\_ini = t.DH\_to\_T(DH)}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{comment}{\# Type of joints, 1 = revolute, 0 = prismatic}}
\DoxyCodeLine{121     info = np.array([1, 1, 1, 1, 1, 1])}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{comment}{\# Initial q}}
\DoxyCodeLine{124     q = np.array([0, 0, 0, 0, 0, 0])}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     \textcolor{comment}{\# Transformation matrices given the configuration}}
\DoxyCodeLine{127     T\_trans = t.transformations(T\_rel\_ini, q\_coppelia, info)}
\DoxyCodeLine{128 }
\DoxyCodeLine{129     \textcolor{comment}{\# T0,1 T0,2 T0,3...T0,e}}
\DoxyCodeLine{130     T\_abs = t.abs\_trans(T\_trans)}
\DoxyCodeLine{131 }
\DoxyCodeLine{132     \textcolor{comment}{\# Extract geometric vectors needed for computations}}
\DoxyCodeLine{133     geom\_v = j.geometric\_vectors(T\_abs)}
\DoxyCodeLine{134 }
\DoxyCodeLine{135     np.set\_printoptions(precision=4)}
\DoxyCodeLine{136     np.set\_printoptions(suppress=\textcolor{keyword}{True})}
\DoxyCodeLine{137 }
\DoxyCodeLine{138     \textcolor{comment}{\# axis of rotation of the revolute joins projected on zero}}
\DoxyCodeLine{139     k = geom\_v[0]}
\DoxyCodeLine{140     \textcolor{comment}{\# distances end\_effector-\/joints projected on zero}}
\DoxyCodeLine{141     r = geom\_v[1]}
\DoxyCodeLine{142 }
\DoxyCodeLine{143     Js = j.jacob(k, r, n\_joints, info)}
\DoxyCodeLine{144 }
\DoxyCodeLine{145     \textcolor{keywordflow}{return} Js}
\DoxyCodeLine{146 }
\DoxyCodeLine{147 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_ab6fa90b8afa2d953a8f166c55b4792c5}\label{namespacejac__mat_ab6fa90b8afa2d953a8f166c55b4792c5}} 
\index{jac\_mat@{jac\_mat}!error\_callback@{error\_callback}}
\index{error\_callback@{error\_callback}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{error\_callback()}{error\_callback()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+error\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{message }\end{DoxyParamCaption})}



Callback Function for the error on the position of the ee. 



Definition at line 171 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{171 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_ab6fa90b8afa2d953a8f166c55b4792c5}{error\_callback}}(message):}
\DoxyCodeLine{172     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{173 \textcolor{stringliteral}{   Callback Function for the error on the position of the ee}}
\DoxyCodeLine{174 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176     \textcolor{keyword}{global} error, readyErr}
\DoxyCodeLine{177     err\_orient = np.array([message.data[:3]]).T}
\DoxyCodeLine{178     err\_pos = np.array([message.data[3:6]]).T}
\DoxyCodeLine{179     error = np.concatenate((err\_pos, err\_orient), axis=0)}
\DoxyCodeLine{180 }
\DoxyCodeLine{181     rospy.loginfo(\textcolor{stringliteral}{"{}Received Position Error:\(\backslash\)n\%s\(\backslash\)n"{}}, str(error))}
\DoxyCodeLine{182 }
\DoxyCodeLine{183     \textcolor{comment}{\# Set the Error as available}}
\DoxyCodeLine{184     readyErr = \textcolor{keyword}{True}}
\DoxyCodeLine{185 }
\DoxyCodeLine{186 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_a79b5770d439fef38364187d16902bf41}\label{namespacejac__mat_a79b5770d439fef38364187d16902bf41}} 
\index{jac\_mat@{jac\_mat}!handle\_IK\_JAnalytic@{handle\_IK\_JAnalytic}}
\index{handle\_IK\_JAnalytic@{handle\_IK\_JAnalytic}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{handle\_IK\_JAnalytic()}{handle\_IK\_JAnalytic()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+handle\+\_\+\+I\+K\+\_\+\+J\+Analytic (\begin{DoxyParamCaption}\item[{}]{req }\end{DoxyParamCaption})}



Handler for the Server\+: computes the ee velocity Vee and the joint velocities vector q\+\_\+dot Vee is computed as\+: Vee = vel + K$\ast$error q\+\_\+dot is computed as\+: q\+\_\+dot = J\# $\ast$ Vee then each value of q\+\_\+dot is saturated in a pre-\/determined interval. 


\begin{DoxyParams}{Parameters}
{\em } & request for service \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+: Jacobian and ee velocity are sent as service 
\end{DoxyReturn}


Definition at line 201 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{201 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a79b5770d439fef38364187d16902bf41}{handle\_IK\_JAnalytic}}(req):}
\DoxyCodeLine{202     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{203 \textcolor{stringliteral}{    Handler for the Server: computes the ee velocity Vee and the joint velocities vector q\_dot }}
\DoxyCodeLine{204 \textcolor{stringliteral}{        Vee is computed as: Vee = vel + K*error}}
\DoxyCodeLine{205 \textcolor{stringliteral}{        q\_dot is computed as: q\_dot = J\# * Vee}}
\DoxyCodeLine{206 \textcolor{stringliteral}{    then each value of q\_dot is saturated in a pre-\/determined interval.}}
\DoxyCodeLine{207 \textcolor{stringliteral}{    @param: request for service}}
\DoxyCodeLine{208 \textcolor{stringliteral}{    @return: Jacobian and ee velocity are sent as service}}
\DoxyCodeLine{209 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211     \textcolor{comment}{\# Declaration to work with global variables}}
\DoxyCodeLine{212     \textcolor{keyword}{global} readyErr, readyJ, readyVel}
\DoxyCodeLine{213 }
\DoxyCodeLine{214     print(\textcolor{stringliteral}{"{}Server Analytic accepted request\(\backslash\)n"{}})}
\DoxyCodeLine{215 }
\DoxyCodeLine{216     \textcolor{keywordflow}{if} (\textcolor{keywordflow}{not} (readyErr \textcolor{keywordflow}{and} readyJ \textcolor{keywordflow}{and} readyVel)):}
\DoxyCodeLine{217         readyErr = readyJ = readyVel = \textcolor{keyword}{False}}
\DoxyCodeLine{218         rospy.logerr(\textcolor{stringliteral}{"{}Analytic J\_6 service could not run: missing data."{}})}
\DoxyCodeLine{219         \textcolor{keywordflow}{return}}
\DoxyCodeLine{220 }
\DoxyCodeLine{221     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{222         readyErr = readyJ = readyVel = \textcolor{keyword}{False}}
\DoxyCodeLine{223 }
\DoxyCodeLine{224         \textcolor{comment}{\# q\_dot initialization}}
\DoxyCodeLine{225         q\_dot = JointState()}
\DoxyCodeLine{226 }
\DoxyCodeLine{227         \textcolor{comment}{\# Gain for the Control Law}}
\DoxyCodeLine{228         K = 10}
\DoxyCodeLine{229 }
\DoxyCodeLine{230         \textcolor{comment}{\# Inverse of the 6dof jacobian}}
\DoxyCodeLine{231         J\_inv = \mbox{\hyperlink{namespacejac__mat_a1b70eedcec80991a4a9e4befb0d4f72a}{regularized\_pseudoinverse}}(J\_6)}
\DoxyCodeLine{232 }
\DoxyCodeLine{233         \textcolor{comment}{\# Ee velocity}}
\DoxyCodeLine{234         vee = vel+K*error}
\DoxyCodeLine{235 }
\DoxyCodeLine{236         \textcolor{comment}{\# q\_dot computation}}
\DoxyCodeLine{237         q\_dot\_6 = J\_inv.dot(vee)}
\DoxyCodeLine{238 }
\DoxyCodeLine{239         \textcolor{comment}{\# q\_dot saturation}}
\DoxyCodeLine{240         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(6):}
\DoxyCodeLine{241             q\_dot\_6[i] = \mbox{\hyperlink{namespacejac__mat_acea62356e13dcd40a0f7b69288cb1ff8}{sat}}(q\_dot\_6[i], -\/1, 1)}
\DoxyCodeLine{242 }
\DoxyCodeLine{243         \textcolor{comment}{\# Since the third Joint is blocked, its velocity must be set to 0}}
\DoxyCodeLine{244         q\_dot.velocity = np.insert(q\_dot\_6, 2, 0)}
\DoxyCodeLine{245 }
\DoxyCodeLine{246         \textcolor{keywordflow}{return} IK\_JTAResponse(q\_dot)}
\DoxyCodeLine{247 }
\DoxyCodeLine{248 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_a8e223e62c8624094cfa20b52b1c098f0}\label{namespacejac__mat_a8e223e62c8624094cfa20b52b1c098f0}} 
\index{jac\_mat@{jac\_mat}!jac\_mat@{jac\_mat}}
\index{jac\_mat@{jac\_mat}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{jac\_mat()}{jac\_mat()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+jac\+\_\+mat (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}This ROS node computes the 6dof analytic jacobian. 
It subscribes to the following topics: errors, tracking, logtopic. 
It also works as a server for the IK_JTA service, on which it sends 
the q_dot and the end effector velocity computed by the algorithm.
\end{DoxyVerb}
 

Definition at line 249 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{249 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a8e223e62c8624094cfa20b52b1c098f0}{jac\_mat}}():}
\DoxyCodeLine{250     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{251 \textcolor{stringliteral}{    This ROS node computes the 6dof analytic jacobian. }}
\DoxyCodeLine{252 \textcolor{stringliteral}{    It subscribes to the following topics: errors, tracking, logtopic. }}
\DoxyCodeLine{253 \textcolor{stringliteral}{    It also works as a server for the IK\_JTA service, on which it sends }}
\DoxyCodeLine{254 \textcolor{stringliteral}{    the q\_dot and the end effector velocity computed by the algorithm.}}
\DoxyCodeLine{255 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{256 }
\DoxyCodeLine{257     \textcolor{comment}{\# Init node}}
\DoxyCodeLine{258     rospy.init\_node(\textcolor{stringliteral}{'jac\_mat'}, anonymous=\textcolor{keyword}{True})}
\DoxyCodeLine{259 }
\DoxyCodeLine{260     rospy.loginfo(\textcolor{stringliteral}{"{}Server Analytic Initialized\(\backslash\)n"{}})}
\DoxyCodeLine{261 }
\DoxyCodeLine{262     \textcolor{comment}{\# Subscribe for error positions}}
\DoxyCodeLine{263     rospy.Subscriber(\textcolor{stringliteral}{"{}errors"{}}, Float64MultiArray, error\_callback)}
\DoxyCodeLine{264 }
\DoxyCodeLine{265     \textcolor{comment}{\# Subscribe for ee velocity}}
\DoxyCodeLine{266     rospy.Subscriber(\textcolor{stringliteral}{"{}tracking"{}}, Float64MultiArray, vel\_callback)}
\DoxyCodeLine{267 }
\DoxyCodeLine{268     \textcolor{comment}{\# Subscribe for joint positions}}
\DoxyCodeLine{269     rospy.Subscriber(\textcolor{stringliteral}{"{}logtopic"{}}, JointState, jacobian\_callback)}
\DoxyCodeLine{270 }
\DoxyCodeLine{271     \textcolor{comment}{\# Service Definition}}
\DoxyCodeLine{272     s\_vel = rospy.Service(\textcolor{stringliteral}{'IK\_JAnalytic'}, IK\_JTA, handle\_IK\_JAnalytic)}
\DoxyCodeLine{273 }
\DoxyCodeLine{274     rospy.spin()}
\DoxyCodeLine{275 }
\DoxyCodeLine{276 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_a3f8d14b0577487e6feb88e38d5518ad5}\label{namespacejac__mat_a3f8d14b0577487e6feb88e38d5518ad5}} 
\index{jac\_mat@{jac\_mat}!jacobian\_callback@{jacobian\_callback}}
\index{jacobian\_callback@{jacobian\_callback}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{jacobian\_callback()}{jacobian\_callback()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+jacobian\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{data }\end{DoxyParamCaption})}



Callback Function for the Joints Positions. 



Definition at line 148 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{148 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a3f8d14b0577487e6feb88e38d5518ad5}{jacobian\_callback}}(data):}
\DoxyCodeLine{149     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{150 \textcolor{stringliteral}{    Callback Function for the Joints Positions}}
\DoxyCodeLine{151 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153     \textcolor{keyword}{global} J\_6, readyJ}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     q\_coppelia = np.array(data.position)}
\DoxyCodeLine{156 }
\DoxyCodeLine{157     \textcolor{comment}{\# It assumes one joint to be fixed (3rd in this case), in order to pass from 7 to 6}}
\DoxyCodeLine{158     q\_coppelia = np.delete(q\_coppelia, 2, 0)}
\DoxyCodeLine{159 }
\DoxyCodeLine{160     rospy.loginfo(\textcolor{stringliteral}{"{}Joint positions: \%s\(\backslash\)n"{}}, str(q\_coppelia))}
\DoxyCodeLine{161 }
\DoxyCodeLine{162     \textcolor{comment}{\# Compute the matrix}}
\DoxyCodeLine{163     J\_6 = \mbox{\hyperlink{namespacejac__mat_a860043b48277a9033f9576db20cc1c63}{calculations\_6}}(q\_coppelia)}
\DoxyCodeLine{164 }
\DoxyCodeLine{165     rospy.loginfo(\textcolor{stringliteral}{"{}Jacobian:\(\backslash\)n\%s\(\backslash\)n"{}}, J\_6)}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     \textcolor{comment}{\# Set the Jacobian as available}}
\DoxyCodeLine{168     readyJ = \textcolor{keyword}{True}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_a1b70eedcec80991a4a9e4befb0d4f72a}\label{namespacejac__mat_a1b70eedcec80991a4a9e4befb0d4f72a}} 
\index{jac\_mat@{jac\_mat}!regularized\_pseudoinverse@{regularized\_pseudoinverse}}
\index{regularized\_pseudoinverse@{regularized\_pseudoinverse}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{regularized\_pseudoinverse()}{regularized\_pseudoinverse()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+regularized\+\_\+pseudoinverse (\begin{DoxyParamCaption}\item[{}]{J }\end{DoxyParamCaption})}



Computes the regularized pseudo inverse of mxn matrix J by applying svd decomposition and multiplication for bell shaped function. 


\begin{DoxyParams}{Parameters}
{\em J} & nxn matrix \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Jx\+: regularized pseudo inverse of the matrix 
\end{DoxyReturn}


Definition at line 58 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{58 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a1b70eedcec80991a4a9e4befb0d4f72a}{regularized\_pseudoinverse}}(J):}
\DoxyCodeLine{59     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{60 \textcolor{stringliteral}{    Computes the regularized pseudo inverse of mxn matrix J }}
\DoxyCodeLine{61 \textcolor{stringliteral}{    by applying svd decomposition and multiplication for bell shaped function}}
\DoxyCodeLine{62 \textcolor{stringliteral}{    @param J: nxn matrix}}
\DoxyCodeLine{63 \textcolor{stringliteral}{    @return Jx: regularized pseudo inverse of the matrix}}
\DoxyCodeLine{64 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     rows = len(J)}
\DoxyCodeLine{67     cols = len(J[0])}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \textcolor{comment}{\# Svd decomposition of the input matrix}}
\DoxyCodeLine{70     U, s, Vt = np.linalg.svd(J)}
\DoxyCodeLine{71     Sx = np.zeros((cols, rows))}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(cols):}
\DoxyCodeLine{74         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(rows):}
\DoxyCodeLine{75             \textcolor{keywordflow}{if} i == j:}
\DoxyCodeLine{76                 Sx[i][j] = s[i]/(s[i]**2 + \mbox{\hyperlink{namespacejac__mat_a701c95f46a60e0d4735aa9f3b9d1c0ad}{bell}}(s[i])**2)}
\DoxyCodeLine{77 }
\DoxyCodeLine{78     Ut = U.transpose()}
\DoxyCodeLine{79     V = Vt.transpose()}
\DoxyCodeLine{80 }
\DoxyCodeLine{81     \textcolor{comment}{\# Reconstruct the pseudo inverse of the matrix with the new regularized values}}
\DoxyCodeLine{82     Jx = V.dot(Sx.dot(Ut))}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{keywordflow}{return} Jx}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_acea62356e13dcd40a0f7b69288cb1ff8}\label{namespacejac__mat_acea62356e13dcd40a0f7b69288cb1ff8}} 
\index{jac\_mat@{jac\_mat}!sat@{sat}}
\index{sat@{sat}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{sat()}{sat()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+sat (\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{xmin,  }\item[{}]{xmax }\end{DoxyParamCaption})}



Saturates the input value in the given interval. 


\begin{DoxyParams}{Parameters}
{\em x} & value to saturate \\
\hline
{\em xmin} & minimum value of the interval \\
\hline
{\em xmax} & maximum value of the interval \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+: saturated value 
\end{DoxyReturn}


Definition at line 30 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{30 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_acea62356e13dcd40a0f7b69288cb1ff8}{sat}}(x, xmin, xmax):}
\DoxyCodeLine{31     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{32 \textcolor{stringliteral}{    Saturates the input value in the given interval}}
\DoxyCodeLine{33 \textcolor{stringliteral}{    @param x: value to saturate}}
\DoxyCodeLine{34 \textcolor{stringliteral}{    @param xmin: minimum value of the interval}}
\DoxyCodeLine{35 \textcolor{stringliteral}{    @param xmax: maximum value of the interval}}
\DoxyCodeLine{36 \textcolor{stringliteral}{    @return: saturated value}}
\DoxyCodeLine{37 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{38     \textcolor{keywordflow}{if} x > xmax:}
\DoxyCodeLine{39         \textcolor{keywordflow}{return} xmax}
\DoxyCodeLine{40     \textcolor{keywordflow}{if} x < xmin:}
\DoxyCodeLine{41         \textcolor{keywordflow}{return} xmin}
\DoxyCodeLine{42     \textcolor{keywordflow}{return} x}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacejac__mat_a12b4ec5da8077136f06320ce5d577407}\label{namespacejac__mat_a12b4ec5da8077136f06320ce5d577407}} 
\index{jac\_mat@{jac\_mat}!vel\_callback@{vel\_callback}}
\index{vel\_callback@{vel\_callback}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{vel\_callback()}{vel\_callback()}}
{\footnotesize\ttfamily def jac\+\_\+mat.\+vel\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{message }\end{DoxyParamCaption})}



Callback Function for the linear and angular velocities of the ee. 



Definition at line 187 of file jac\+\_\+mat.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{187 \textcolor{keyword}{def }\mbox{\hyperlink{namespacejac__mat_a12b4ec5da8077136f06320ce5d577407}{vel\_callback}}(message):}
\DoxyCodeLine{188     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{189 \textcolor{stringliteral}{    Callback Function for the linear and angular velocities of the ee}}
\DoxyCodeLine{190 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{191 }
\DoxyCodeLine{192     \textcolor{keyword}{global} vel, readyVel}
\DoxyCodeLine{193     vel = np.array([message.data[:6]]).T}
\DoxyCodeLine{194 }
\DoxyCodeLine{195     rospy.loginfo(\textcolor{stringliteral}{"{}Received Velocities End Effector:\(\backslash\)n\%s\(\backslash\)n"{}}, str(vel))}
\DoxyCodeLine{196 }
\DoxyCodeLine{197     \textcolor{comment}{\# Set the Vel as available}}
\DoxyCodeLine{198     readyVel = \textcolor{keyword}{True}}
\DoxyCodeLine{199 }
\DoxyCodeLine{200 }

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespacejac__mat_a85ca3feeaa6ba1dfd16285a59c4ef174}\label{namespacejac__mat_a85ca3feeaa6ba1dfd16285a59c4ef174}} 
\index{jac\_mat@{jac\_mat}!readyErr@{readyErr}}
\index{readyErr@{readyErr}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{readyErr}{readyErr}}
{\footnotesize\ttfamily bool jac\+\_\+mat.\+ready\+Err = False}



Definition at line 25 of file jac\+\_\+mat.\+py.

\mbox{\Hypertarget{namespacejac__mat_af336a5a7bf90772409bbb56da3c600c9}\label{namespacejac__mat_af336a5a7bf90772409bbb56da3c600c9}} 
\index{jac\_mat@{jac\_mat}!readyJ@{readyJ}}
\index{readyJ@{readyJ}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{readyJ}{readyJ}}
{\footnotesize\ttfamily bool jac\+\_\+mat.\+readyJ = False}



Definition at line 26 of file jac\+\_\+mat.\+py.

\mbox{\Hypertarget{namespacejac__mat_a707dd549cfb0f1316be715adebc23f90}\label{namespacejac__mat_a707dd549cfb0f1316be715adebc23f90}} 
\index{jac\_mat@{jac\_mat}!readyVel@{readyVel}}
\index{readyVel@{readyVel}!jac\_mat@{jac\_mat}}
\doxysubsubsection{\texorpdfstring{readyVel}{readyVel}}
{\footnotesize\ttfamily bool jac\+\_\+mat.\+ready\+Vel = False}



Definition at line 27 of file jac\+\_\+mat.\+py.

