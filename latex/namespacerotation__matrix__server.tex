\hypertarget{namespacerotation__matrix__server}{}\doxysection{rotation\+\_\+matrix\+\_\+server Namespace Reference}
\label{namespacerotation__matrix__server}\index{rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacerotation__matrix__server_a7aaa0fb233a7f3aaaac351a1a8cd3ce3}{euler\+Angles\+To\+Rotation\+Matrix}} (\mbox{\hyperlink{namespacerotation__matrix__server_ad621155b63e203c5d2051a1104121e19}{angles}})
\begin{DoxyCompactList}\small\item\em Function that transforms euler angle coordinates into the rotation matrix. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacerotation__matrix__server_a2f936f96eeb146c595089ad895e8fd18}{angles\+Compensate}} (\mbox{\hyperlink{namespacerotation__matrix__server_ad621155b63e203c5d2051a1104121e19}{angles}})
\begin{DoxyCompactList}\small\item\em Function used to filter unwanted minimal incoming data fluctuations, due to noise as well as human operator shake. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacerotation__matrix__server_a1848f7eec568b1685bcc12a2e5a5b08f}{callback}} (data)
\begin{DoxyCompactList}\small\item\em This is the callback function\+: it is invoked every time there is incoming data. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacerotation__matrix__server_ad446c256f9728cf9487b89f0adecd7d6}{serv\+\_\+callback}} ()
\begin{DoxyCompactList}\small\item\em This is the server callback function. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacerotation__matrix__server_a07d43064af42bc34d24a3425b2d8680b}{smartphone\+\_\+server\+\_\+setup}} ()
\begin{DoxyCompactList}\small\item\em Setup of the server. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
float \mbox{\hyperlink{namespacerotation__matrix__server_a1d811e084b2bbc6579824327afd2016a}{dx}} = 0.\+0174
\item 
list \mbox{\hyperlink{namespacerotation__matrix__server_ad621155b63e203c5d2051a1104121e19}{angles}} = \mbox{[}0, 0, 0\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Documentation for the rotation matrix sever
This file waits for rotation matrix transformations requests;
it has been made mostly for convenience of the optimization project subgroup
\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacerotation__matrix__server_a2f936f96eeb146c595089ad895e8fd18}\label{namespacerotation__matrix__server_a2f936f96eeb146c595089ad895e8fd18}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!anglesCompensate@{anglesCompensate}}
\index{anglesCompensate@{anglesCompensate}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{anglesCompensate()}{anglesCompensate()}}
{\footnotesize\ttfamily def rotation\+\_\+matrix\+\_\+server.\+angles\+Compensate (\begin{DoxyParamCaption}\item[{}]{angles }\end{DoxyParamCaption})}



Function used to filter unwanted minimal incoming data fluctuations, due to noise as well as human operator shake. 


\begin{DoxyParams}{Parameters}
{\em angles} & orientation with respect to X, Y, Z axes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
returns a filtered version (if necessary) of the input angles 
\end{DoxyReturn}


Definition at line 51 of file rotation\+\_\+matrix\+\_\+server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{51 \textcolor{keyword}{def }\mbox{\hyperlink{namespacerotation__matrix__server_a2f936f96eeb146c595089ad895e8fd18}{anglesCompensate}}(angles):}
\DoxyCodeLine{52     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{53 \textcolor{stringliteral}{    Function used to filter unwanted minimal incoming data fluctuations,}}
\DoxyCodeLine{54 \textcolor{stringliteral}{    due to noise as well as human operator shake}}
\DoxyCodeLine{55 \textcolor{stringliteral}{    @param angles orientation with respect to X, Y, Z axes}}
\DoxyCodeLine{56 \textcolor{stringliteral}{    @returns returns a filtered version (if necessary) of the input angles}}
\DoxyCodeLine{57 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{58     \textcolor{comment}{\# reduce sensibility of sensor: minimum precision is dx}}
\DoxyCodeLine{59     compensatedAngles = [0, 0, 0]}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, 3):  \textcolor{comment}{\# i = 0, 1, 2}}
\DoxyCodeLine{62         \textcolor{keywordflow}{if} abs(angles[i] / dx) >= 1:}
\DoxyCodeLine{63             compensatedAngles[i] = angles[i]}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{keywordflow}{return} compensatedAngles}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacerotation__matrix__server_a1848f7eec568b1685bcc12a2e5a5b08f}\label{namespacerotation__matrix__server_a1848f7eec568b1685bcc12a2e5a5b08f}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!callback@{callback}}
\index{callback@{callback}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{callback()}{callback()}}
{\footnotesize\ttfamily def rotation\+\_\+matrix\+\_\+server.\+callback (\begin{DoxyParamCaption}\item[{}]{data }\end{DoxyParamCaption})}



This is the callback function\+: it is invoked every time there is incoming data. 

It transforms a quaternion into euler angles, and the invokes \mbox{\hyperlink{namespacerotation__matrix__server_a2f936f96eeb146c595089ad895e8fd18}{angles\+Compensate()}} 
\begin{DoxyParams}{Parameters}
{\em data} & incoming from the imu sensor \\
\hline
\end{DoxyParams}


Definition at line 68 of file rotation\+\_\+matrix\+\_\+server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{68 \textcolor{keyword}{def }\mbox{\hyperlink{namespacerotation__matrix__server_a1848f7eec568b1685bcc12a2e5a5b08f}{callback}}(data):}
\DoxyCodeLine{69     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{70 \textcolor{stringliteral}{    This is the callback function: it is invoked every time there is incoming data.}}
\DoxyCodeLine{71 \textcolor{stringliteral}{    It transforms a quaternion into euler angles, and the invokes anglesCompensate()}}
\DoxyCodeLine{72 \textcolor{stringliteral}{    @param data incoming from the imu sensor}}
\DoxyCodeLine{73 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{74     \textcolor{keyword}{global} angles}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     \textcolor{comment}{\# get data}}
\DoxyCodeLine{77     orientation = [data.orientation.x, data.orientation.y,}
\DoxyCodeLine{78                    data.orientation.z, data.orientation.w]}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{comment}{\# transform quaternion to euler angles}}
\DoxyCodeLine{81     angles = tf.transformations.euler\_from\_quaternion(orientation, \textcolor{stringliteral}{"{}sxyz"{}})}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     angles = \mbox{\hyperlink{namespacerotation__matrix__server_a2f936f96eeb146c595089ad895e8fd18}{anglesCompensate}}(angles)}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacerotation__matrix__server_a7aaa0fb233a7f3aaaac351a1a8cd3ce3}\label{namespacerotation__matrix__server_a7aaa0fb233a7f3aaaac351a1a8cd3ce3}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!eulerAnglesToRotationMatrix@{eulerAnglesToRotationMatrix}}
\index{eulerAnglesToRotationMatrix@{eulerAnglesToRotationMatrix}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{eulerAnglesToRotationMatrix()}{eulerAnglesToRotationMatrix()}}
{\footnotesize\ttfamily def rotation\+\_\+matrix\+\_\+server.\+euler\+Angles\+To\+Rotation\+Matrix (\begin{DoxyParamCaption}\item[{}]{angles }\end{DoxyParamCaption})}



Function that transforms euler angle coordinates into the rotation matrix. 


\begin{DoxyParams}{Parameters}
{\em angles} & euler angles, i.\+e. orientation with respect to X, Y, Z axes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
rotation matrix 
\end{DoxyReturn}


Definition at line 24 of file rotation\+\_\+matrix\+\_\+server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{24 \textcolor{keyword}{def }\mbox{\hyperlink{namespacerotation__matrix__server_a7aaa0fb233a7f3aaaac351a1a8cd3ce3}{eulerAnglesToRotationMatrix}}(angles):  \textcolor{comment}{\# angles [roll, pitch, yaw]}}
\DoxyCodeLine{25     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{26 \textcolor{stringliteral}{    Function that transforms euler angle coordinates into the rotation matrix}}
\DoxyCodeLine{27 \textcolor{stringliteral}{    @param angles euler angles, i.e. orientation with respect to X, Y, Z axes}}
\DoxyCodeLine{28 \textcolor{stringliteral}{    @returns rotation matrix}}
\DoxyCodeLine{29 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31     R\_x = np.array([[1,         0,                  0],}
\DoxyCodeLine{32                     [0,         math.cos(angles[0]),   math.sin(angles[0])],}
\DoxyCodeLine{33                     [0,         -\/math.sin(angles[0]),  math.cos(angles[0])]}
\DoxyCodeLine{34                     ])}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     R\_y = np.array([[math.cos(angles[1]),    0,      -\/math.sin(angles[1])],}
\DoxyCodeLine{37                     [0,                      1,      0],}
\DoxyCodeLine{38                     [math.sin(angles[1]),    0,      math.cos(angles[1])]}
\DoxyCodeLine{39                     ])}
\DoxyCodeLine{40 }
\DoxyCodeLine{41     R\_z = np.array([[math.cos(angles[2]),      math.sin(angles[2]),     0],}
\DoxyCodeLine{42                     [-\/math.sin(angles[2]),     math.cos(angles[2]),     0],}
\DoxyCodeLine{43                     [0,                        0,                       1]}
\DoxyCodeLine{44                     ])}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     R = np.dot(R\_x, np.dot(R\_y, R\_z))}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \textcolor{keywordflow}{return} R}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacerotation__matrix__server_ad446c256f9728cf9487b89f0adecd7d6}\label{namespacerotation__matrix__server_ad446c256f9728cf9487b89f0adecd7d6}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!serv\_callback@{serv\_callback}}
\index{serv\_callback@{serv\_callback}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{serv\_callback()}{serv\_callback()}}
{\footnotesize\ttfamily def rotation\+\_\+matrix\+\_\+server.\+serv\+\_\+callback (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



This is the server callback function. 

It simply formats the data coming from the Imu in order to be compatible with the Optimization subgroup\textquotesingle{}s code \begin{DoxyReturn}{Returns}
the a formatted version of the rotation matrix 
\end{DoxyReturn}


Definition at line 86 of file rotation\+\_\+matrix\+\_\+server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{86 \textcolor{keyword}{def }\mbox{\hyperlink{namespacerotation__matrix__server_ad446c256f9728cf9487b89f0adecd7d6}{serv\_callback}}():}
\DoxyCodeLine{87     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{88 \textcolor{stringliteral}{    This is the server callback function. It simply formats the data coming from the Imu in order}}
\DoxyCodeLine{89 \textcolor{stringliteral}{    to be compatible with the Optimization subgroup's code}}
\DoxyCodeLine{90 \textcolor{stringliteral}{    @returns the a formatted version of the rotation matrix}}
\DoxyCodeLine{91 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     serv\_rot\_matrix = Float64MultiArray()}
\DoxyCodeLine{94     serv\_rot\_matrix.layout.dim.append(MultiArrayDimension())}
\DoxyCodeLine{95     serv\_rot\_matrix.layout.dim.append(MultiArrayDimension())}
\DoxyCodeLine{96     serv\_rot\_matrix.layout.dim[0].label = \textcolor{stringliteral}{"{}rows"{}}}
\DoxyCodeLine{97     serv\_rot\_matrix.layout.dim[0].size = 3}
\DoxyCodeLine{98     serv\_rot\_matrix.layout.dim[1].label = \textcolor{stringliteral}{"{}columns"{}}}
\DoxyCodeLine{99     serv\_rot\_matrix.layout.dim[1].size = 3}
\DoxyCodeLine{100     serv\_rot\_matrix.data = \mbox{\hyperlink{namespacerotation__matrix__server_a7aaa0fb233a7f3aaaac351a1a8cd3ce3}{eulerAnglesToRotationMatrix}}(angles)}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{keywordflow}{return} SmartphoneResponse(serv\_rot\_matrix)}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacerotation__matrix__server_a07d43064af42bc34d24a3425b2d8680b}\label{namespacerotation__matrix__server_a07d43064af42bc34d24a3425b2d8680b}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!smartphone\_server\_setup@{smartphone\_server\_setup}}
\index{smartphone\_server\_setup@{smartphone\_server\_setup}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{smartphone\_server\_setup()}{smartphone\_server\_setup()}}
{\footnotesize\ttfamily def rotation\+\_\+matrix\+\_\+server.\+smartphone\+\_\+server\+\_\+setup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Setup of the server. 

Inside this function there is the \textquotesingle{}smartphone\+\_\+service\textquotesingle{} node initialization and the subscription to the \textquotesingle{}android/imu\textquotesingle{} topic, from which it receives incoming data of smarthpone/smartwatch accelerometers. Finally, the rotation matrix server is activated 

Definition at line 105 of file rotation\+\_\+matrix\+\_\+server.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{105 \textcolor{keyword}{def }\mbox{\hyperlink{namespacerotation__matrix__server_a07d43064af42bc34d24a3425b2d8680b}{smartphone\_server\_setup}}():}
\DoxyCodeLine{106     \textcolor{stringliteral}{"{}"{}"{}!}}
\DoxyCodeLine{107 \textcolor{stringliteral}{    Setup of the server. Inside this function there is the 'smartphone\_service' node initialization}}
\DoxyCodeLine{108 \textcolor{stringliteral}{    and the subscription to the 'android/imu' topic, from which it receives incoming data}}
\DoxyCodeLine{109 \textcolor{stringliteral}{    of smarthpone/smartwatch accelerometers. Finally, the rotation matrix server is activated}}
\DoxyCodeLine{110 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     \textcolor{comment}{\# In ROS, nodes are uniquely named. If two nodes with the same}}
\DoxyCodeLine{113     \textcolor{comment}{\# name are launched, the previous one is kicked off. The}}
\DoxyCodeLine{114     \textcolor{comment}{\# anonymous=True flag means that rospy will choose a unique}}
\DoxyCodeLine{115     \textcolor{comment}{\# name for our 'smartphone\_service' node, so that multiple nodes can}}
\DoxyCodeLine{116     \textcolor{comment}{\# run simultaneously without any issue.}}
\DoxyCodeLine{117     rospy.init\_node(\textcolor{stringliteral}{'smartphone\_service'}, anonymous=\textcolor{keyword}{True})  \textcolor{comment}{\# initialize node}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119     \textcolor{comment}{\# This declares that your node subscribes to the android/imu topic,}}
\DoxyCodeLine{120     \textcolor{comment}{\# which is of type sensor\_msgs.msg.Imu. When new data is received,}}
\DoxyCodeLine{121     \textcolor{comment}{\# callback is invoked with that data as argument.}}
\DoxyCodeLine{122     rospy.Subscriber(\textcolor{stringliteral}{"{}android/imu"{}}, Imu, callback)}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     \textcolor{comment}{\# activate service}}
\DoxyCodeLine{125     serv = rospy.Service(\textcolor{stringliteral}{'smartphone\_serv'}, Smartphone, serv\_callback)}
\DoxyCodeLine{126     \textcolor{keywordflow}{print} (\textcolor{stringliteral}{"{}\(\backslash\)nService server setup and running"{}})}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \textcolor{comment}{\# spin() simply keeps python from exiting until this node is stopped}}
\DoxyCodeLine{129     rospy.spin()}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 }

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespacerotation__matrix__server_ad621155b63e203c5d2051a1104121e19}\label{namespacerotation__matrix__server_ad621155b63e203c5d2051a1104121e19}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!angles@{angles}}
\index{angles@{angles}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{angles}{angles}}
{\footnotesize\ttfamily list rotation\+\_\+matrix\+\_\+server.\+angles = \mbox{[}0, 0, 0\mbox{]}}



Definition at line 21 of file rotation\+\_\+matrix\+\_\+server.\+py.

\mbox{\Hypertarget{namespacerotation__matrix__server_a1d811e084b2bbc6579824327afd2016a}\label{namespacerotation__matrix__server_a1d811e084b2bbc6579824327afd2016a}} 
\index{rotation\_matrix\_server@{rotation\_matrix\_server}!dx@{dx}}
\index{dx@{dx}!rotation\_matrix\_server@{rotation\_matrix\_server}}
\doxysubsubsection{\texorpdfstring{dx}{dx}}
{\footnotesize\ttfamily float rotation\+\_\+matrix\+\_\+server.\+dx = 0.\+0174}



Definition at line 19 of file rotation\+\_\+matrix\+\_\+server.\+py.

